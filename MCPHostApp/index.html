<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Chatbot with Image Upload</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2rem;
            background: #fafafa;
        }

        #chat {
            max-width: 600px;
            margin: auto;
        }

        .msg {
            margin: .5em 0;
            padding: .5em 1em;
            border-radius: .75em;
        }

        .user {
            background: #d9fdd3;
            align-self: flex-end;
        }

        .bot {
            background: #f1f0f0;
        }

        form {
            display: flex;
            gap: .5em;
            flex-wrap: wrap;
            margin-top: 1em;
        }
    </style>
</head>
<body>
    <div id="chat"></div>
    <form id="chatForm">
        <input type="text" id="message" placeholder="Type your message..." required style="flex:1" />
        <input type="file" id="file" accept="image/*" />
        <button type="submit">Send</button>
    </form>

    <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('chatForm');

    function addMsg(text, cls) {
      const div = document.createElement('div');
      div.className = `msg ${cls}`;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    form.onsubmit = async (e) => {
      e.preventDefault();
      const msg = document.getElementById('message').value;
      const file = document.getElementById('file').files[0];

      addMsg(msg, 'user');

      const data = new FormData();
      data.append('message', msg);
      if (file) data.append('file', file);

      addMsg('...', 'bot');

      const res = await fetch('/chat', { method: 'POST', body: data });
      const result = await res.json();

      chat.lastChild.textContent = result.reply;
      form.reset();
    };
    </script>
</body>
</html>